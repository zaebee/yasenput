jQuery(document).ajaxSend(function(a,b,c){function d(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;c.length>d;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function e(a){var b=document.location.host,c=document.location.protocol,d="//"+b,e=c+d;return a==e||a.slice(0,e.length+1)==e+"/"||a==d||a.slice(0,d.length+1)==d+"/"||!/^(\/\/|http:|https:).*/.test(a)}function f(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}$(document).ready(function(){$(window).scrollTop(370),console.log("\u041f\u041e\u041d\u0415\u0421\u041b\u0410\u0421\u042c!!!!!")}),!f(c.type)&&e(c.url)&&b.setRequestHeader("X-CSRFToken",d("csrftoken"))}),function(){$.fn.simpleTabs=function(a){var b=$.extend({attrTarget:"data-target",beforeChange:function(){},afterChange:function(){}},a);return $(this).each(function(){function d(a){b.beforeChange(c,$(".active",c).attr(b.attrTarget)),$("#"+a).css("display","block").siblings().css("display","none"),b.afterChange(c,a)}var c=$(this);c.data("simpleTabs")||(c.data("simpleTabs","simpleTabs"),$(".active",this).length?d($(".active",this).attr(b.attrTarget)):($(this).children(":first").addClass("active"),d($(".active",this).attr(b.attrTarget))),$("a",this).click(function(a){a.preventDefault(),d($(this).attr(b.attrTarget)),$(this).addClass("active").siblings().removeClass("active")}))})}}(jQuery);var multySearch;jQuery(function(a){function m(a,b){b.width(241*(0^(a-80)/241))}function n(b){var c=a(window).width(),d=a("#header .auth").outerWidth();b.css({marginLeft:0,left:(c+212-d)/2-207})}function q(){a("#overlay").is(":visible")?a("body").css("overflow","hidden"):a("body").css("overflow","visible")}a("#multisearch-text").live("keyup",function(b){8==b.keyCode&&0==a("#multisearch-text").val().length&&a(".label-fields").find(".label:not(.label-add):last .remove-label").click()}),multySearch={me:0,tmplLabel:'<div class="label {clsName}">                    {text}                        <button class="remove-label"></button>                    </div>',setWidthInput:function(){var b=a(this.p.labelField).width()-6,c=0,d=0;a(this.p.labelField).children(".label:visible").each(function(){var e=a(this).offset();e.top!=d?(d=e.top,c=0,c+=a(this).outerWidth(!0)):c+=a(this).outerWidth(!0)}),a(this.p.searchInput).width(b-c-4)},showDropField:function(){a(this.p.dropRoot).show().find(".selected").removeClass("selected"),a(this.p.labelAdd).hide(),a(this.p.searchInput).show(),a("input[type=text]",a(this.p.searchInput)).focus(),this.setWidthInput()},hideDropField:function(){var b=this;a(b.p.dropRoot).hide(),a("input[type=text]",a(b.p.searchInput)).val("").blur(),a(b.p.labelAdd).show(),a(b.p.searchInput).hide(),setTimeout(function(){b.setWidthInput()},0)},onFocusInput:function(b,c){a(document).bind("keydown.focus",function(a){setTimeout(function(){38!=a.which&&40!=a.which&&13!=a.which&&27!=a.which&&c.findMatch((""+b.val()).toLowerCase())},0)}),c.setWidthInput()},findMatch:function(b){var c=RegExp(b);a("a",a(this.p.dropRoot)).each(function(){var d=c.test(a(this).text().toLowerCase())?"removeClass":"addClass";b||(d="addClass"),a(this).parent()[d]("hidden")})},selectDropLi:function(b){var c=this;console.log("selectDropLi"),a("li.selected:hidden",a(this.p.dropRoot)).removeClass("selected");var e,d=a("li:visible:has(a)",a(this.p.dropRoot)).filter(function(){if(a(c.p.dropRoot).closest("#header").length){if(a(this).closest(".item-labels").length){var b=a(c.p.dropRoot).offset().top+a(c.p.dropRoot).outerHeight();return b>a(this).offset().top?!0:(a(this).hasClass("selected")&&a(this).removeClass("selected"),!1)}var d=a(".toggle-panel").hasClass("open-panel")?10:5;if(!a(".drop-search .toggle-panel").hasClass("open-panel"))return a(this).parent().find("li:visible").index(this)>d?!1:!0}return!0});d.filter(".selected").length?(e=d.index(d.filter(".selected")),d.length-1>e?1==b?(d.filter(".selected:first").removeClass("selected"),d.eq(e+1).addClass("selected")):(d.filter(".selected:first").removeClass("selected"),d.eq(e-1).addClass("selected")):(d.filter(".selected:first").removeClass("selected"),1==b?d.eq(0).addClass("selected"):d.eq(e-1).addClass("selected"))):1==b?d.eq(0).addClass("selected"):d.last().addClass("selected")},onKeyDown:function(b,c){switch(console.log("\u041d\u0430\u0436\u0430\u043b\u0438!",b),b.which){case 13:b.preventDefault();var d=!1;_.each(multisearch_data.tags,function(b){b.name.toLowerCase()==a("#multisearch-text").val().toLowerCase()&&(a("#multisearch-tags a").filter(function(){return a.data(this,"id")==b.id}).end().click(),d=!0)}),multisearch_data.places.length>0&&!d&&(console.log("\u041f\u043e\u043f\u0430\u043b\u0441\u044f --->",a("#multisearch-places a").filter(function(){return 0==a.data(this,"id")})),a("#multisearch-places a").filter(function(){return 0==a.data(this,"id")}).click()),console.log("\u043d\u0430\u0436\u0430\u0442 enter",ymaps.geolocation.latitude);break;case 27:setTimeout(function(){c.hideDropField()},0);break;case 38:b.preventDefault(),c.selectDropLi(-1);break;case 8:break;case 40:b.preventDefault(),c.selectDropLi(1)}},onClickDrop:function(b,c){console.log("onClickDrop"),window.currentPoints.page=1,window.currentCollectionPoints.page=1;var d="";if(text_labels=[],b.closest(".item-place").length){d=" label-place",multisearch_result.places.length=0,a(".label-fields").children(".label-place").remove(),split_labels=b.text().split(", "),i=0,_.each(split_labels,function(a){multisearch_result.places.push(a),text_labels.push({text:a,id:i,type:"place"}),console.log("LABEL!!!!!!!!!!!--------->",multisearch_result.points.indexOf(a)),-1==multisearch_result.points.indexOf(a),i++});var e=ymaps.geocode(b.text());e.then(function(a){console.log("SETBOUND"),console.log(ymaps.geolocation.latitude),window.myMap.setBounds(a.geoObjects.get(0).properties.get("boundedBy"))},function(){alert("\u041e\u0448\u0438\u0431\u043a\u0430")})}else if(b.closest(".item-name").length)d=" label-name",console.log("name"),multisearch_result.points.length=0,a(".label-fields").children(".label-name").remove(),id=multisearch_data.points[b.data("id")].id,name=multisearch_data.points[b.data("id")].name,-1!=multisearch_result.points.indexOf(name)?console.log("returned_names"):(console.log("onClickDrop name"),multisearch_result.points.push(name),text_labels.push({text:b.text(),id:multisearch_result.points.length-1,type:"point"}));else if(b.closest(".item-users").length){if(d=" label-user",id=multisearch_data.users[b.data("id")].id,console.log(multisearch_result.users),-1!=multisearch_result.users.indexOf(id))return console.log("returned"),c.hideDropField(),void 0;a(".label-fields").children(".label-user").remove(),multisearch_result.users=[],multisearch_result.users.push(id),text_labels.push({text:b.text(),id:multisearch_result.users.length-1,type:"user"})}else if(b.closest(".item-labels").length){if(d=" label-label",label_id=b.data("id"),id=multisearch_data.tags[label_id].id,-1!=multisearch_result.tags.indexOf(id))return;multisearch_result.tags.push(id),text_labels.push({text:b.text(),id:multisearch_result.tags.length-1,type:"tag"})}a(c.p.labelAdd).show(),_.each(text_labels,function(b){var e=c.tmplLabel.replace("{clsName}",d).replace("{text}",b.text);added_label=a(e).insertBefore(a(c.p.labelAdd)),a(added_label).data("id",b.id),a(added_label).data("type",b.type)}),window.currentPoints.clearing(),window.currentPoints.setURL().fetch(),window.currentCollectionPoints.setURL().fetch(),console.log("Complited"),c.hideDropField()},init:function(b){me=this,me.p=b,me.setWidthInput(),a(window).resize(function(){me.setWidthInput()}),a(this.p.labelAdd).click(function(){me.showDropField()}),a(this.p.labelField).click(function(a){a.target==this&&me.showDropField()}),a("input[type=text]",a(this.p.searchInput)).focus(function(){me.onFocusInput(a(this),me)}),a(document).bind("keydown.findMatch",function(b){a(me.p.dropRoot).is(":visible")&&me.onKeyDown(b,me)}),a("a",me.p.dropRoot).click(function(b){b.preventDefault(),me.onClickDrop(a(this),me)}),a(document).click(function(b){a(me.p.dropRoot).is(":visible")&&!a(b.target).closest(me.p.root).length&&me.hideDropField()})},reinit_click:function(){a("a",me.p.dropRoot).click(function(b){console.log("REINIT_CLICK"),b.preventDefault(),me.onClickDrop(a(this),me)})}},window.multySearch=multySearch;var b=a.extend({},multySearch),c=a.extend({},multySearch);if(b.init({searchInput:a("#p-labels .selected-labels .text-field"),labelField:a("#p-labels .selected-labels"),dropRoot:a(".drop-labels-field"),labelAdd:a("#p-labels .label-add"),root:a("#p-labels .drop-labels")}),c.init({searchInput:a("#header .text-field"),labelField:a("#header .label-fields"),dropRoot:a(".drop-search"),labelAdd:a("#header .label-add"),root:a("#header .search")}),a(".drop-search").click(function(a){a.stopImmediatePropagation()}),a(".label-fields").delegate(".remove-label","click",function(){switch(console.log("delete"),id=a(this).parents(".label").data("id"),type=a(this).parents(".label").data("type"),console.log("delete:",multisearch_result.points),console.log("delete2:",multisearch_data.points),type){case"point":multisearch_result.points.length=0,a(this).parents(".label").remove();break;case"place":multisearch_result.places.splice(id,multisearch_result.places.length-id),console.log("\u041a\u043e\u0441\u0442\u044b\u043b\u044c: ",multisearch_result.places),_.each(a(this).parents(".label-fields").children(".label-place"),function(b){lab_id=a(b).data("id"),lab_id>=id&&a(b).remove()});var c=ymaps.geocode(multisearch_result.places.join(","));c.then(function(a){window.myMap.setBounds(a.geoObjects.get(0).properties.get("boundedBy"))});break;case"user":multisearch_result.users.splice(id,1),a(this).parents(".label").remove();break;case"tag":multisearch_result.tags.splice(id,1),a(this).parents(".label").remove()}console.log("after delete:",multisearch_result.points),console.log("after delete2:",multisearch_data.points)}),a(".drop-search ul").hover(function(){var b=a(this);b.stop().animate({width:"58%",left:14*b.index()+"%"}),b.prev().length&&b.prevAll().each(function(c){var d=b.prevAll().length-c-1;a(this).stop().animate({left:14*d+"%",width:"14%"})}),b.next().length&&b.nextAll().each(function(c){var d=3==b.nextAll().length?c:1==b.nextAll().length?2+c:1+c;a(this).stop().animate({left:14*d+58+"%",width:"14%"})})}),a(".drop-search").mouseleave(function(){a(".drop-search ul").each(function(b){a(this).stop().animate({width:"25%",left:25*b+"%"},300)})}),a(".drop-search .toggle-panel").click(function(b){b.preventDefault();var c=a(this).hasClass("open-panel")?135:240;a(".drop-search").stop().animate({height:c},200),a(this).toggleClass("open-panel")}),a(".a-toggle").click(function(b){if(b.preventDefault(),a(b.target).closest(".main-map").length){var c=a(b.target).closest(".main-map");c.hasClass("hide-map")?(a(this).html("\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043a\u0430\u0440\u0442\u0443 &uarr;"),c.css("top",0).removeClass("hide-map"),c.addClass("is-open"),a(".main-map .m-ico-group").show()):(a(this).html("\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043a\u0430\u0440\u0442\u0443 &darr;"),370>=a(window).scrollTop()&&a(window).scrollTop(370),c.css("top",-370).addClass("hide-map"),c.removeClass("is-open"),a(".main-map .m-ico-group").hide())}else a(b.target).closest("#footer").length&&(a("body").toggleClass("hide-footer"),a(".a-up").toggleClass("a-up-toggle"))}),a(".a-up").click(function(b){b.preventDefault(),a("html, body").animate({scrollTop:0})}),a(window).scroll(function(){a(window).scrollTop()>65?a(".a-up").show():a(".a-up").hide();var b=a(window).scrollTop(),c=370>=b?b:370;a(".main-map").hasClass("is-open")||(a(".main-map").css("top",-c),b>=370?a(".main-map").hasClass("hide-map")||(a(".main-map").addClass("hide-map").find(".a-toggle").html("\u0420\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043a\u0430\u0440\u0442\u0443 &darr;"),a(".main-map .m-ico-group").hide()):(a(".main-map").removeClass("hide-map").find(".a-toggle").html("\u0421\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043a\u0430\u0440\u0442\u0443 &uarr;"),a(".main-map .m-ico-group").show()))}),a(".content .items").length&&a(".content .items").masonry({itemSelector:".item",columnWidth:241}),a(".calendar").length&&a(".calendar").is(":visible")){var d={changedEl:".calendar select",visRows:5,scrollArrows:!0};cuSel(d)}a("#popups .scroll-box").click(function(b){b.target==this&&(a("#confirm-remove-photo").is(":visible")?a("#confirm-remove-photo").hide():a("#complaint-place").is(":visible")?a("#complaint-place").hide():a("#complaint-photo").is(":visible")?a("#complaint-photo").hide():a("#complaint-comment").is(":visible")?a("#complaint-comment").hide():a("#confirm-remove-comment").is(":visible")?a("#confirm-remove-comment").hide():window.YPApp.popups.close({elem:a("#popups"),speed:0,callbackBefore:function(){window.YPApp.popups.close({elem:a("#overlay")})},callbackAfter:function(){a("body").css("overflow","visible")}}))});var o=a("#content .content .items"),p=a("#header nav");m(a(window).width(),o),n(p),a(window).resize(function(){m(a(window).width(),o),n(p)}),q(),a(document).ready(function(){a(window).scrollTop(370),console.log("\u041f\u041e\u041d\u0415\u0421\u041b\u0410\u0421\u042c!!!!!")})});